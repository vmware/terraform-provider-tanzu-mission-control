---
Title: "Data Protection Resource"
Description: |-
   Enabling data protection
---

# Cluster Data Protection Resource

This resource enables users to activate and set up data protection for a cluster.
Once enabled, users can create instant backups or schedule backups for later.

For more information regarding data protection, see [Data Protection][data-protection].

[data-protection]: https://docs.vmware.com/en/VMware-Tanzu-Mission-Control/services/tanzumc-concepts/GUID-C16557BC-EB1B-4414-8E63-28AD92E0CAE5.html

## Cluster Scope Example Usage

```terraform
resource "tanzu-mission-control_enable_data_protection" "demo" {
  scope {
    cluster {
      cluster_name            = "CLS_NAME"
      management_cluster_name = "MGMT_CLS_NAME"
      provisioner_name        = "PROVISIONER_NAME"
    }
  }

  spec {
    disable_restic                       = false
    enable_csi_snapshots                 = false
    enable_all_api_group_versions_backup = false
  }

  deletion_policy {
    delete_backups = false
  }
}
```

## Cluster Group Scope Example Usage

```terraform
resource "tanzu-mission-control_enable_data_protection" "cgdemo" {
  scope {
    cluster_group {
      cluster_group_name            = "default"
    }
  }

  spec {
    disable_restic                       = false
    enable_csi_snapshots                 = false
    enable_all_api_group_versions_backup = false

    selector {
        labelselector {
            matchexpressions {
                key      = "site"
                operator = "NotIn"
                values   = [
                    "one",
                    "two"
                ]
            }
        }
    }
  }

  deletion_policy {
    delete_backups = false
    force = true
  }
}
```


**NOTE :** To resolve cluster and cluster group data protection conflicts use the below command
``terraform refresh``

For instance, in case cluster group data protection is created on already existing data protection at cluster level.
Use above command and remove cluster level data protection resource from the terraform file.
Similarly, in case of disable data protection, use above command and remove associated backup schedule from terraform file.

## Import Cluster Scope Data Protection
The resource ID for importing an existing data protection should be comprised of a full cluster name separated by '/'.

```bash
terraform import tanzu-mission-control_enable_data_protection.demo_dp MANAGEMENT_CLUSTER_NAME/PROVISIONER_NAME/CLUSTER_NAME
```

## Import Cluster Group Scope Data Protection
The resource ID for importing an existing data protection should be comprised of a cluster group name separated.

```bash
terraform import tanzu-mission-control_enable_data_protection.demo_dp_cg CLUSTER_GROUP_NAME
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `scope` (Block List, Min: 1, Max: 1) Scope block for Data Protection (cluster/cluster group) (see [below for nested schema](#nestedblock--scope))

### Optional

- `deletion_policy` (Block List, Max: 1) Deletion policy block of data protection (see [below for nested schema](#nestedblock--deletion_policy))
- `meta` (Block List, Max: 1) Metadata for the resource (see [below for nested schema](#nestedblock--meta))
- `spec` (Block List, Max: 1) Spec of enable data protection (see [below for nested schema](#nestedblock--spec))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--scope"></a>
### Nested Schema for `scope`

Optional:

- `cluster` (Block List, Max: 1) Cluster scope block (see [below for nested schema](#nestedblock--scope--cluster))
- `cluster_group` (Block List, Max: 1) Cluster group scope block (see [below for nested schema](#nestedblock--scope--cluster_group))

<a id="nestedblock--scope--cluster"></a>
### Nested Schema for `scope.cluster`

Required:

- `cluster_name` (String) Cluster name
- `management_cluster_name` (String) Management cluster name
- `provisioner_name` (String) Cluster provisioner name


<a id="nestedblock--scope--cluster_group"></a>
### Nested Schema for `scope.cluster_group`

Required:

- `cluster_group_name` (String) Cluster group name



<a id="nestedblock--deletion_policy"></a>
### Nested Schema for `deletion_policy`

Optional:

- `delete_backups` (Boolean) Destroy backups upon deleting data protection.
(default: false)
- `force` (Boolean) Disable data protection on all clusters in the cluster group even if cluster level schedules present.


<a id="nestedblock--meta"></a>
### Nested Schema for `meta`

Optional:

- `annotations` (Map of String) Annotations for the resource
- `description` (String) Description of the resource
- `labels` (Map of String) Labels for the resource

Read-Only:

- `resource_version` (String) Resource version of the resource
- `uid` (String) UID of the resource


<a id="nestedblock--spec"></a>
### Nested Schema for `spec`

Optional:

- `disable_restic` (Boolean) A flag to indicate whether to skip installation of restic server (https://github.com/restic/restic).
Otherwise, restic would be enabled by default as part of Data Protection installation.
(Default: False)
- `enable_all_api_group_versions_backup` (Boolean) A flag to indicate whether to backup all the supported API Group versions of a resource on the cluster.
(Default: False)
- `enable_csi_snapshots` (Boolean) A flag to indicate whether to install CSI snapshotting related capabilities.
(Default: False)
- `selector` (Block List, Max: 1) A selector to include/exclude specific clusters in a cluster group (optional) (see [below for nested schema](#nestedblock--spec--selector))
- `use_node_agent` (Boolean) A flag to indicate whether to install the node agent daemonset which is responsible for volume data transfer to the target location.

<a id="nestedblock--spec--selector"></a>
### Nested Schema for `spec.selector`

Optional:

- `excludednames` (List of String)
- `labelselector` (Block List) (see [below for nested schema](#nestedblock--spec--selector--labelselector))
- `names` (List of String)

<a id="nestedblock--spec--selector--labelselector"></a>
### Nested Schema for `spec.selector.labelselector`

Optional:

- `matchexpressions` (Block List) (see [below for nested schema](#nestedblock--spec--selector--labelselector--matchexpressions))

<a id="nestedblock--spec--selector--labelselector--matchexpressions"></a>
### Nested Schema for `spec.selector.labelselector.matchexpressions`

Required:

- `values` (List of String)

Optional:

- `key` (String)
- `operator` (String)
